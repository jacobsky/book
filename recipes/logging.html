<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Logging - The godot-rust Book</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../getting-started.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/setup.html"><strong aria-hidden="true">2.1.</strong> Setup</a></li><li class="chapter-item expanded "><a href="../getting-started/hello-world.html"><strong aria-hidden="true">2.2.</strong> Hello, world!</a></li></ol></li><li class="chapter-item expanded "><a href="../gdnative-overview.html"><strong aria-hidden="true">3.</strong> An Overview of GDNative</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../gdnative-overview/data-representations.html"><strong aria-hidden="true">3.1.</strong> Data representations</a></li><li class="chapter-item expanded "><a href="../gdnative-overview/wrappers.html"><strong aria-hidden="true">3.2.</strong> Ref, TRef and Instance</a></li><li class="chapter-item expanded "><a href="../gdnative-overview/architecture.html"><strong aria-hidden="true">3.3.</strong> Game architecture</a></li></ol></li><li class="chapter-item expanded "><a href="../rust-binding.html"><strong aria-hidden="true">4.</strong> Binding to Rust code</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust-binding/classes.html"><strong aria-hidden="true">4.1.</strong> Class registration</a></li><li class="chapter-item expanded "><a href="../rust-binding/methods.html"><strong aria-hidden="true">4.2.</strong> Exported methods</a></li><li class="chapter-item expanded "><a href="../rust-binding/properties.html"><strong aria-hidden="true">4.3.</strong> Exported properties</a></li><li class="chapter-item expanded "><a href="../rust-binding/to-variant-from-variant-export.html"><strong aria-hidden="true">4.4.</strong> ToVariant, FromVariant and Export</a></li><li class="chapter-item expanded "><a href="../rust-binding/calling-gdscript.html"><strong aria-hidden="true">4.5.</strong> Calling into GDScript from Rust</a></li></ol></li><li class="chapter-item expanded "><a href="../faq.html"><strong aria-hidden="true">5.</strong> FAQ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../faq/code.html"><strong aria-hidden="true">5.1.</strong> Common code questions</a></li><li class="chapter-item expanded "><a href="../faq/multithreading.html"><strong aria-hidden="true">5.2.</strong> Multithreading</a></li><li class="chapter-item expanded "><a href="../faq/configuration.html"><strong aria-hidden="true">5.3.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../faq/support.html"><strong aria-hidden="true">5.4.</strong> Versioning and supported platforms</a></li><li class="chapter-item expanded "><a href="../faq/community.html"><strong aria-hidden="true">5.5.</strong> Community</a></li><li class="chapter-item expanded "><a href="../faq/godot4.html"><strong aria-hidden="true">5.6.</strong> Godot 4.0 Status</a></li></ol></li><li class="chapter-item expanded "><a href="../testing.html"><strong aria-hidden="true">6.</strong> (TODO) Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../testing/structure.html"><strong aria-hidden="true">6.1.</strong> Structuring code for testing</a></li><li class="chapter-item expanded "><a href="../testing/engine.html"><strong aria-hidden="true">6.2.</strong> Testing with the engine</a></li></ol></li><li class="chapter-item expanded "><a href="../recipes.html"><strong aria-hidden="true">7.</strong> Recipes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../recipes/async-tokio.html"><strong aria-hidden="true">7.1.</strong> Async with Tokio runtime</a></li><li class="chapter-item expanded "><a href="../recipes/custom-node-plugin.html"><strong aria-hidden="true">7.2.</strong> Custom node plugin</a></li><li class="chapter-item expanded "><a href="../recipes/external-resources.html"><strong aria-hidden="true">7.3.</strong> Loading external resources</a></li><li class="chapter-item expanded "><a href="../recipes/logging.html" class="active"><strong aria-hidden="true">7.4.</strong> Logging</a></li><li class="chapter-item expanded "><a href="../recipes/nix-build-system.html"><strong aria-hidden="true">7.5.</strong> Nix as development environment</a></li><li class="chapter-item expanded "><a href="../recipes/panic-handler.html"><strong aria-hidden="true">7.6.</strong> Rust panic handler</a></li></ol></li><li class="chapter-item expanded "><a href="../projects.html"><strong aria-hidden="true">8.</strong> Third-party projects</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../projects/games.html"><strong aria-hidden="true">8.1.</strong> Games</a></li><li class="chapter-item expanded "><a href="../projects/tools.html"><strong aria-hidden="true">8.2.</strong> Tools and integrations</a></li><li class="chapter-item expanded "><a href="../projects/applications.html"><strong aria-hidden="true">8.3.</strong> Applications</a></li></ol></li><li class="chapter-item expanded "><a href="../exporting.html"><strong aria-hidden="true">9.</strong> Exporting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../exporting/android.html"><strong aria-hidden="true">9.1.</strong> Android</a></li><li class="chapter-item expanded "><a href="../exporting/ios.html"><strong aria-hidden="true">9.2.</strong> (TODO) iOS</a></li><li class="chapter-item expanded "><a href="../exporting/macosx.html"><strong aria-hidden="true">9.3.</strong> Mac OS X</a></li></ol></li><li class="chapter-item expanded "><a href="../advanced-guides.html"><strong aria-hidden="true">10.</strong> Advanced Guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced-guides/custom-godot.html"><strong aria-hidden="true">10.1.</strong> Using custom Godot versions</a></li><li class="chapter-item expanded "><a href="../advanced-guides/migrating-0-8.html"><strong aria-hidden="true">10.2.</strong> Migrating from godot-rust 0.8</a></li><li class="chapter-item expanded "><a href="../advanced-guides/migrating-0-9.html"><strong aria-hidden="true">10.3.</strong> Migrating from godot-rust 0.9</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The godot-rust Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="recipe-logging"><a class="header" href="#recipe-logging">Recipe: Logging</a></h1>
<p>Logging in Godot can be accessed by using the <code>godot_print!</code>, <code>godot_warn!</code>, and <code>godot_error!</code> macros.</p>
<p>These macros only work when the library is loaded by Godot. They will panic instead when invoked outside that context, for example, when the crate is being tested with cargo test</p>
<h2 id="simple-wrapper-macros-for-test-configurations"><a class="header" href="#simple-wrapper-macros-for-test-configurations">Simple wrapper macros for test configurations</a></h2>
<p>The first option that you have is wrap the <code>godot_print!</code> macros in the following macro that will use <code>godot_print!</code> when running with Godot, and stdout when run during tests.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// prints to Godot's console, except in tests, there it prints to stdout
macro_rules! console_print {
    ($($args:tt)*) =&gt; ({
        if cfg!(test) {
            println!($($args)*);
        } else {
            gdnative::godot_print!($($args)*);
        }
    });
}
<span class="boring">}
</span></code></pre></pre>
<h2 id="using-a-logging-crate"><a class="header" href="#using-a-logging-crate">Using a logging Crate</a></h2>
<p>A more robust solution is to integrate an existing logging library.</p>
<p>This recipe demonstrates using the <code>log</code> crate with <code>flexi-logger</code>. While most of this guide will work with other backends, the initialization and <code>LogWriter</code> implementation may differ.</p>
<p>First add the following crates to your <code>Cargo.toml</code> file. You may want to check the crates.io pages of the crates for any updates.</p>
<pre><code class="language-toml">log = &quot;0.4.14&quot;
flexi_logger = &quot;0.17.1&quot;
</code></pre>
<p>Then, write some code that glues the logging crates with Godot's logging interface. <code>flexi-logger</code>, for example, requires a <code>LogWriter</code> implementation:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use gdnative::prelude::*;
use flexi_logger::writers::LogWriter;
use flexi_logger::{DeferredNow, Record};
use log::{Level, LevelFilter};

pub struct GodotLogWriter {}

impl LogWriter for GodotLogWriter {
    fn write(&amp;self, _now: &amp;mut DeferredNow, record: &amp;Record) -&gt; std::io::Result&lt;()&gt; {
        match record.level() {
            // Optionally push the Warnings to the godot_error! macro to display as an error in the Godot editor.
            flexi_logger::Level::Error =&gt; godot_error!(&quot;{}:{} -- {}&quot;, record.level(), record.target(), record.args()),
            // Optionally push the Warnings to the godot_warn!  macro to display as a warning in the Godot editor.
            flexi_logger::Level::Warn =&gt; godot_warn!(&quot;{}:{} -- {}&quot;,record.level(), record.target(), record.args()),
            _ =&gt; godot_print!(&quot;{}:{} -- {}&quot;, record.level(), record.target(), record.args())
        }        ;
        Ok(())
    }

    fn flush(&amp;self) -&gt; std::io::Result&lt;()&gt; {
        Ok(())
    }

    fn max_log_level(&amp;self) -&gt; LevelFilter {
        LevelFilter::Trace
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>For the logger setup, place the code logger configuration code in your <code>fn init(handle: InitHandle)</code> as follows.</p>
<p>To add the logging configuration, you need to add the initial configuration and start the logger inside the init function.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn init(handle: InitHandle) {
    flexi_logger::Logger::with_str(&quot;trace&quot;)
        .log_target(flexi_logger::LogTarget::Writer(Box::new(crate::util::GodotLogWriter {})))
        .start()
        .expect(&quot;the logger should start&quot;);
    /* other initialization work goes here */ 
}
godot_init!(init);
<span class="boring">}
</span></code></pre></pre>
<h3 id="setting-up-a-log-target-for-tests"><a class="header" href="#setting-up-a-log-target-for-tests">Setting up a log target for tests</a></h3>
<p>When running in a test configuration, if you would like logging functionality, you will need to initialize a log target.</p>
<p>As tests are run in parallel, it will be necessary to use something like the following code to initialize the logger only once. The <code>#[cfg(test)]</code> attributes are used to ensure that this code is not accessible outside of test builds.</p>
<p>Place this in your crate root (usually lib.rs)</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[cfg(test)]
use std::sync::Once;
#[cfg(test)]
static TEST_LOGGER_INIT: Once = Once::new();
#[cfg(test)]
fn test_setup_logger() {
    TEST_LOGGER_INIT.call_once(||{
        flexi_logger::Logger::with_str(&quot;debug&quot;)
        .log_target(flexi_logger::LogTarget::StdOut)
        .start()
        .expect(&quot;the logger should start&quot;);
    });
}
<span class="boring">}
</span></code></pre></pre>
<p>You can call the above code in your units tests with <code>crate::test_setup_logger()</code>. Please note: currently there does not appear to be a tes case that will be called before tests are configured, so the <code>test_setup_logger</code> will need to be called in every test where you require log output.</p>
<p>Now that the logging is configured, you can use use it in your code such as in the following sample</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>log::trace!(&quot;trace message: {}&quot;, &quot;message string&quot;);
log::debug!(&quot;debug message: {}&quot;, &quot;message string&quot;);
log::info!(&quot;info message: {}&quot;, &quot;message string&quot;);
log::warn!(&quot;warning message: {}&quot;, &quot;message string&quot;);
log::error!(&quot;error message: {}&quot;, &quot;message string&quot;);
<span class="boring">}
</span></code></pre></pre>
<p>At this point, we have a logging solution implemented for our Rust based code that will pipe the log messages to Godot.</p>
<p>But what about GDScript? It would be nice to have consistent log messages in both GDScript and GDNative. One way to ensure that is to expose the logging functionality to Godot with a <code>NativeClass</code>.</p>
<h3 id="exposing-to-gdscript"><a class="header" href="#exposing-to-gdscript">Exposing to GDScript</a></h3>
<blockquote>
<h3 id="note"><a class="header" href="#note">Note</a></h3>
<p>As the Rust macros cannot get the GDScript name or resource_path, it is necessary to pass the log target from GDScript.</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(NativeClass, Copy, Clone, Default)]
#[user_data(Aether&lt;DebugLogger&gt;)]
#[inherit(Node)]
pub struct DebugLogger;

#[methods]
impl DebugLogger {
    fn new(_: &amp;Node) -&gt; Self {
        Self {}
    }
    #[export]
    fn error(&amp;self, _owner: &amp;Node, target: String, message: String) {
        log::error!(target: &amp;target, &quot;{}&quot;, message);
    }
    #[export]
    fn warn(&amp;self, _: &amp;Node, target: String, message: String) {
        log::warn!(target: &amp;target, &quot;{}&quot;, message);
    }
    #[export]
    fn info(&amp;self, _: &amp;Node, target: String, message: String) {
        log::info!(target: &amp;target, &quot;{}&quot;, message);
    }
    #[export]
    fn debug(&amp;self, _: &amp;Node, target: String, message: String) {
        log::debug!(target: &amp;target, &quot;{}&quot;, message);
    }
    #[export]
    fn trace(&amp;self, _: &amp;Node, target: String, message: String) {
        log::trace!(target: &amp;target, &quot;{}&quot;, message);
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>After adding the class above with <code>handle.add_class::&lt;DebugLogger&gt;()</code> in the <code>init</code> function, you may add it as an Autoload Singleton in your project for easy access. In the example below, the name &quot;game_logger&quot; is chosen for the Autoload singleton:</p>
<pre><code class="language-gdscript">game_logger.trace(&quot;name_of_script.gd&quot;, &quot;this is a trace message&quot;)
game_logger.debug(&quot;name_of_script.gd&quot;, &quot;this is a debug message&quot;)
game_logger.info(&quot;name_of_script.gd&quot;, &quot;this is an info message&quot;)
game_logger.warn(&quot;name_of_script.gd&quot;, &quot;this is a warning message&quot;)
game_logger.error(&quot;name_of_script.gd&quot;, &quot;this is an error message&quot;)
</code></pre>
<p>As this is not very ergonomic, it is possible to make a more convenient access point that you can use in your scripts. To make the interface closer to the Rust one, we can create a <code>Logger</code> class in GDScript that will call the global methods with the name of our script class.</p>
<pre><code class="language-gdscript">extends Reference

class_name Logger

var _script_name

func _init(script_name: String) -&gt; void:
	self._script_name = script_name

func trace(msg: String) -&gt; void:
	D.trace(self._script_name, msg)
	
func debug(msg: String) -&gt; void:
	D.debug(self._script_name, msg)

func info(msg: String) -&gt; void:
	D.info(self._script_name, msg)

func warn(msg: String) -&gt; void:
	D.warn(self._script_name, msg)

func error(msg: String) -&gt; void:
	D.error(self._script_name, msg)
</code></pre>
<p>To use the above class, create an instance of <code>Logger</code> in a local variable with the desired <code>script_name</code> and use it as in the script example below:</p>
<pre><code class="language-gdscript">extends Node

var logger = Logger.new(&quot;script_name.gd&quot;)

func _ready() -&gt; void:
    logger.info(&quot;_ready&quot;)
</code></pre>
<p>And now you have a logging solution fully implemented in Rust and usable in GDScript.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../recipes/external-resources.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../recipes/nix-build-system.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../recipes/external-resources.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../recipes/nix-build-system.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
